!function(){function e(e,t){if("string"==typeof e){var n=function(){var n=document.querySelector(e);return n&&(n.innerHTML=t),n},s=n();return s||setTimeout(n,0),s}return e&&(e.innerHTML=t),e}var t=function(e){console.log("-> ajax",e),s.show("Loading data..."),r(e.url,e.method||"GET",function(t){t.result&&t.redirect?(console.log("-> redirect",t.redirect),document.location.href=t.redirect):(e.title&&(t.title=e.title),o(t,e.tplFile),s.hide())},e.data)},n=nunjucks.env,s={getCont:function(){return document.querySelector(".msg")},hide:function(){var t=this.getCont();setTimeout(function(){e(t,"")},1e3)},show:function(t,n){if(t){var s="";s=n?"alert-success":n===!1?"alert-error":"alert-info",e(this.getCont(),'<span class="alert '+s+'">'+t+"</span>")}else this.hide()}},o=function(o,r){if(console.log("-> render",o,r),o.title&&(document.title=o.title,e(".subheader",o.title)),s.show(o.msg,o.result),r){var l=n.render(r,o);e("main",l);var a=document.querySelector("main form");a&&(a.onsubmit=function(e){e.preventDefault(),t({url:this.action,method:this.method,tplFile:r,data:i(this)}),console.log("-> onsumbit",this)})}},i=function(e){if(e&&"FORM"===e.nodeName){var t,n,s=[];for(t=e.elements.length-1;t>=0;t-=1)if(""!==e.elements[t].name)switch(e.elements[t].nodeName){case"INPUT":switch(e.elements[t].type){case"text":case"hidden":case"password":case"button":case"reset":case"submit":s.push(e.elements[t].name+"="+encodeURIComponent(e.elements[t].value));break;case"checkbox":case"radio":e.elements[t].checked&&s.push(e.elements[t].name+"="+encodeURIComponent(e.elements[t].value))}break;case"file":break;case"TEXTAREA":s.push(e.elements[t].name+"="+encodeURIComponent(e.elements[t].value));break;case"SELECT":switch(e.elements[t].type){case"select-one":s.push(e.elements[t].name+"="+encodeURIComponent(e.elements[t].value));break;case"select-multiple":for(n=e.elements[t].options.length-1;n>=0;n-=1)e.elements[t].options[n].selected&&s.push(e.elements[t].name+"="+encodeURIComponent(e.elements[t].options[n].value))}break;case"BUTTON":switch(e.elements[t].type){case"reset":case"submit":case"button":s.push(e.elements[t].name+"="+encodeURIComponent(e.elements[t].value))}}return s.join("&")}},r=function(e,t,n,s){if(this.bindFunction=function(e,t){return function(){return e.apply(t,[t])}},this.stateChange=function(){4==this.request.readyState&&this.callbackFunction(JSON.parse(this.request.responseText))},this.getRequest=function(){return window.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):window.XMLHttpRequest?new XMLHttpRequest:!1},this.postBody=s||"",this.callbackFunction=n,this.url=e,this.request=this.getRequest(),this.request){var o=this.request;o.onreadystatechange=this.bindFunction(this.stateChange,this),o.open(t,e,!1),o.setRequestHeader("X-Requested-With","XMLHttpRequest"),"POST"==t&&o.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),o.send(this.postBody),console.log("-> ajax sending",e,t,this.postBody)}};routie({login:function(){t({url:"./?action=user_login",tplFile:"login.nj.html"})},logout:function(){t({url:"./?action=user_logout",method:"POST"})},reg:function(){t({url:"./?action=user_new",tplFile:"userCreate.nj.html"})},"user/:id":function(e){t({url:"./?action=user_edit&id="+parseInt(e),tplFile:"edit.nj.html"})},"new":function(){t({url:"./?action=entry_new",tplFile:"edit.nj.html",title:"New message"})},"msg/:id":function(e){t({url:"./?action=entry_edit&id="+parseInt(e),tplFile:"edit.nj.html"})},"msg/:id/ok":function(e){t({url:"./?action=entry_approve&id="+parseInt(e),method:"POST"})},"msg/:id/off":function(e){t({url:"./?action=entry_delete&id="+parseInt(e),method:"POST"})},"":function(){console.log("-> default"),t({url:"./?action=entries",tplFile:"entryList.nj.html"})}})}();