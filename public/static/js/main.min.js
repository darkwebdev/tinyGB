!function(){var e=function(e){console.log("send",e),n.show("Loading data..."),i(e.url,function(t){t.redirect?document.location.href="/":(s(t,e.tplFile),n.hide())},e.data)},t=nunjucks.env,n={getCont:function(){return document.querySelector(".msg")},hide:function(){console.log("msg",this,document.querySelector(this.cont)),this.getCont().innerHTML=""},show:function(e,t){if(console.log("msg",this),e){var n="";n=t?"alert-success":t===!1?"alert-error":"alert-info";var s=this.getCont();s&&(s.innerHTML='<span class="alert '+n+'">'+e+"</span>")}else this.hide()}},s=function(s,i){if(console.log("client render",s,i),s.title&&(document.title=s.title,document.querySelector(".subheader").innerHTML=s.title),n.show(s.msg,s.result),i){var l=t.render(i,s),c=document.querySelector("main");console.log("client render",c,l),c.innerHTML=l;var r=document.querySelector("main form");r&&(r.onsubmit=function(t){t.preventDefault(),e({url:this.action,method:this.method,tplFile:i,data:o(this)}),console.log("onsumbit",this)})}},o=function(e){if(e&&"FORM"===e.nodeName){var t,n,s=[];for(t=e.elements.length-1;t>=0;t-=1)if(""!==e.elements[t].name)switch(e.elements[t].nodeName){case"INPUT":switch(e.elements[t].type){case"text":case"hidden":case"password":case"button":case"reset":case"submit":s.push(e.elements[t].name+"="+encodeURIComponent(e.elements[t].value));break;case"checkbox":case"radio":e.elements[t].checked&&s.push(e.elements[t].name+"="+encodeURIComponent(e.elements[t].value))}break;case"file":break;case"TEXTAREA":s.push(e.elements[t].name+"="+encodeURIComponent(e.elements[t].value));break;case"SELECT":switch(e.elements[t].type){case"select-one":s.push(e.elements[t].name+"="+encodeURIComponent(e.elements[t].value));break;case"select-multiple":for(n=e.elements[t].options.length-1;n>=0;n-=1)e.elements[t].options[n].selected&&s.push(e.elements[t].name+"="+encodeURIComponent(e.elements[t].options[n].value))}break;case"BUTTON":switch(e.elements[t].type){case"reset":case"submit":case"button":s.push(e.elements[t].name+"="+encodeURIComponent(e.elements[t].value))}}return s.join("&")}},i=function(e,t,n){if(this.bindFunction=function(e,t){return function(){return e.apply(t,[t])}},this.stateChange=function(){4==this.request.readyState&&this.callbackFunction(JSON.parse(this.request.responseText))},this.getRequest=function(){return window.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):window.XMLHttpRequest?new XMLHttpRequest:!1},this.postBody=n||"",this.callbackFunction=t,this.url=e,this.request=this.getRequest(),this.request){var s=this.request;s.onreadystatechange=this.bindFunction(this.stateChange,this),""!==this.postBody?(s.open("POST",e,!0),s.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8")):s.open("GET",e,!0),s.setRequestHeader("X-Requested-With","XMLHttpRequest"),s.send(this.postBody)}};routie({login:function(){e({url:"./?action=user_login",tplFile:"login.nj.html"})},logout:function(){e({url:"./?action=user_logout",method:"POST"})},reg:function(){e({url:"./?action=user_new",tplFile:"userCreate.nj.html"})},"user/:id":function(t){e({url:"./?action=user_edit&id="+parseInt(t),tplFile:"edit.nj.html"})},"new":function(){e({url:"./?action=entry_new",tplFile:"edit.nj.html"})},"msg/:id":function(t){e({url:"./?action=entry_edit&id="+parseInt(t),tplFile:"edit.nj.html"})},"msg/:id/delete":function(t){confirm("Do you really want to delete this message?")&&(e({url:"./?action=entry_delete&id="+parseInt(t),method:"POST"}),routie(""))},"":function(){console.log("default"),e({url:"./?action=entries",tplFile:"entryList.nj.html"})}})}();