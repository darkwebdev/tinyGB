!function(){var e=function(e){console.log("send",e),n.show("Loading data..."),o(e.url,e.method||"GET",function(t){t.result&&t.redirect&&e.redirect?(console.log("----->client redirect",e.redirect),document.location.href=e.redirect):(e.title&&(t.title=e.title),i(t,e.tplFile),n.hide())},e.data)},t=nunjucks.env,n={getCont:function(){return document.querySelector(".msg")},hide:function(){var e=this.getCont();setTimeout(function(){e.innerHTML=""},1e3)},show:function(e,t){if(console.log("msg",this),e){var n=this.getCont();if(n){var i="";i=t?"alert-success":t===!1?"alert-error":"alert-info",n.innerHTML='<span class="alert '+i+'">'+e+"</span>"}}else this.hide()}},i=function(i,o){if(console.log("client render",i,o),i.title&&(document.title=i.title,document.querySelector(".subheader").innerHTML=i.title),n.show(i.msg,i.result),o){var r=t.render(o,i),c=document.querySelector("main");c.innerHTML=r;var l=document.querySelector("main form");l&&(l.onsubmit=function(t){t.preventDefault(),e({url:this.action,method:this.method,tplFile:o,data:s(this)}),console.log("onsumbit",this)})}},s=function(e){if(e&&"FORM"===e.nodeName){var t,n,i=[];for(t=e.elements.length-1;t>=0;t-=1)if(""!==e.elements[t].name)switch(e.elements[t].nodeName){case"INPUT":switch(e.elements[t].type){case"text":case"hidden":case"password":case"button":case"reset":case"submit":i.push(e.elements[t].name+"="+encodeURIComponent(e.elements[t].value));break;case"checkbox":case"radio":e.elements[t].checked&&i.push(e.elements[t].name+"="+encodeURIComponent(e.elements[t].value))}break;case"file":break;case"TEXTAREA":i.push(e.elements[t].name+"="+encodeURIComponent(e.elements[t].value));break;case"SELECT":switch(e.elements[t].type){case"select-one":i.push(e.elements[t].name+"="+encodeURIComponent(e.elements[t].value));break;case"select-multiple":for(n=e.elements[t].options.length-1;n>=0;n-=1)e.elements[t].options[n].selected&&i.push(e.elements[t].name+"="+encodeURIComponent(e.elements[t].options[n].value))}break;case"BUTTON":switch(e.elements[t].type){case"reset":case"submit":case"button":i.push(e.elements[t].name+"="+encodeURIComponent(e.elements[t].value))}}return i.join("&")}},o=function(e,t,n,i){if(this.bindFunction=function(e,t){return function(){return e.apply(t,[t])}},this.stateChange=function(){4==this.request.readyState&&this.callbackFunction(JSON.parse(this.request.responseText))},this.getRequest=function(){return window.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):window.XMLHttpRequest?new XMLHttpRequest:!1},this.postBody=i||"",this.callbackFunction=n,this.url=e,this.request=this.getRequest(),this.request){var s=this.request;s.onreadystatechange=this.bindFunction(this.stateChange,this),"POST"==t?(s.open("POST",e,!0),s.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8")):s.open("GET",e,!0),s.setRequestHeader("X-Requested-With","XMLHttpRequest"),s.send(this.postBody)}};routie({login:function(){e({url:"./?action=user_login",tplFile:"login.nj.html",redirect:"/"})},logout:function(){e({url:"./?action=user_logout",method:"POST",redirect:"/"})},reg:function(){e({url:"./?action=user_new",tplFile:"userCreate.nj.html",redirect:"/"})},"user/:id":function(t){e({url:"./?action=user_edit&id="+parseInt(t),tplFile:"edit.nj.html",redirect:"#"})},"new":function(){e({url:"./?action=entry_new",tplFile:"edit.nj.html",title:"New message",redirect:"#"})},"msg/:id":function(t){e({url:"./?action=entry_edit&id="+parseInt(t),tplFile:"edit.nj.html",redirect:"#"})},"msg/:id/ok":function(t){e({url:"./?action=entry_approve&id="+parseInt(t),method:"POST",redirect:"#"})},"msg/:id/off":function(t){e({url:"./?action=entry_delete&id="+parseInt(t),method:"POST",redirect:"#"})},"":function(){console.log("default"),e({url:"./?action=entries",tplFile:"entryList.nj.html"})}})}();